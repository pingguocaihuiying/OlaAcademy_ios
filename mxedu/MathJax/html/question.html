<!doctype html>
<html>

<head>
    <meta name="viewport" content="telephone=no, user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
        
    <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                               messageStyle: "none",
                               tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
                               });
            </script>
        
    <script type="text/javascript" src="../MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="../jquery.js"></script>
        
    <style type='text/css'>
        ul li {
            list-style: none;
            color: #51535E;
            position: relative;
            padding-top: 5%;
            padding-bottom: 5%;
            border-bottom: 1px solid #f0f0f0;
        }
        .listStyle:before  {
            position: absolute;
            display: block;
            content: attr(data-option);
            padding-top: .25em;
            text-align: center;
            color: #4285E4;
            left: -2.5em;
            width: 1.8em;
            height: 1.8em;
            background-repeat: no-repeat;
            background-size: 1.8em 1.8em;
            background-position: 0em 0em;
            background-image: url('ic_circle.png');
        }
        .selectListStyle:before  {
            color: white;
            background-image: url('ic_point.png');
        }
        
        
        .optionLine { border-bottom:1px solid #f0f0f0; padding-top:10px; color: #51535E; font-size:16px; padding-bottom:10px;}
        .blueContent{color:#4285E4; }
        .center {
            text-align:center
        }
        .auto_image { max-height:120px; max-width:320px;
            autoimg:expression(onload=function(){this.style.width=(this.offsetWidth > 320)?"320px":"auto"});
        }
        .button {
            display: inline-block;
            width: 100%;
            outline: none;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            color: #fff;
            font: 14px/100% Arial, Helvetica, sans-serif;
            padding: .5em 2em .55em;
            text-shadow: 0 1px 1px rgba(0,0,0,.3);
            -webkit-border-radius: .5em;
            -moz-border-radius: .5em;
            border-color: #0099ff;
            border-radius: .5em;
            -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.2);
            -moz-box-shadow: 0 1px 2px rgba(0,0,0,.2);
            box-shadow: 0 1px 2px rgba(0,0,0,.2);
            background: #4285E4;
        }
        .button:hover {
            text-decoration: none;
        }
        .button:active {
            position: relative;
            top: 1px;
        }
    </style>
</head>

<body>

    <script>
        
    var obj;
        
    // 加载试题
    function loadQuestion(data) {
        
        obj = eval ("(" + JSON.stringify(data) + ")");
        
        //题目
        var questionDIV = document.getElementById('question');
        questionDIV.className = 'optionLine';
        questionDIV.innerHTML = obj.title;
        // 重新加载
        MathJax.Hub.Queue(["Typeset",MathJax.Hub,questionDIV]);
        
        var html = "<ul id='ul' style='width: 90%; margin-top: 0px;'>";
        var optionList = $.parseJSON(data.option);;
        $.each(optionList, function(i, value) {
            html += "<li class='listStyle' id='"+i+"'>"+ value.content+"</li>";
        });
        html+='</ul>';
               
        var optionDIV = document.getElementById("option");
        optionDIV.innerHTML = html;
        MathJax.Hub.Queue([ "Typeset", MathJax.Hub, optionDIV ]);
        
        //行点击事件
        $("#ul li").click(function(){
            $(this).toggleClass("selectListStyle");
            $("#ul li[id!='"+ $(this).attr("id")+"']").removeClass("selectListStyle");
        });
                                 
        //选中
        var i=0;
        $("#ul li").each(function(){
            if(obj.currentChoice!=null&&obj.currentChoice!=""){
                if(i++==obj.currentChoice){
                    $(this).toggleClass("selectListStyle");
                }else{
                    $(this).removeClass("selectListStyle");
                }
                $(this).attr('data-option',String.fromCharCode(i + 64));
            }else{
                $(this).attr('data-option',String.fromCharCode(i++ + 65));
            }
        })
        
        
        //图片
        var questionImage = document.getElementById("img");
        if(obj.pic.length>0){
            questionImage.style.display="";
            questionImage.src = obj.pic;
        }else{
            questionImage.style.display="none";
        }
        
        
        //答案
        var answerDIV = document.getElementById('answer');
        answerDIV.innerHTML = '正确答案: <span class="blueContent">'+ String.fromCharCode(obj.rightanswer)+'</span>'; //ascii码砖字符
        
        //解析
        var analysisDIV = document.getElementById('analysis');
        analysisDIV.innerHTML = obj.hint;
        MathJax.Hub.Queue(["Typeset",MathJax.Hub,analysisDIV]);
        
        //解析图片
        var hintImage = document.getElementById("hintimg");
        hintImage.src = obj.hintpic;
        
        if(obj.showAnswer=='1'){
            document.getElementById("showBtn").style.display="none";
            var correctDIV  = document.getElementById("answerCorrect");
            if(obj.type=='2'){
                correctDIV.style.display="";
                if(obj.answerCorrect=='1'){
                    correctDIV.innerHTML = '答案正确';
                    correctDIV.style.color = "#0099ff";
                }else{
                    correctDIV.innerHTML = '答案错误';
                    correctDIV.style.color = "red";
                }
            }
            if(obj.hintpic.length>0){
                hintImage.style.display="";
                hintImage.src = obj.hintpic;
            }else{
                hintImage.style.display="none";
            }
            document.getElementById("answer").style.display="";
            document.getElementById("label").style.display="none";
            document.getElementById("analysis").style.display="";
        }else{
            if(obj.type=='1'||obj.type=='3'){
                document.getElementById("showBtn").style.display="";
            }else{
                document.getElementById("showBtn").style.display="none";
            }
            hintImage.style.display="none";
            document.getElementById("answer").style.display="none";
            document.getElementById("label").style.display="none";
            document.getElementById("analysis").style.display="none";
        }
    }
    
    //显示答案
    function showAnswer(){
        document.getElementById("showBtn").style.display="none";
        document.getElementById("answer").style.display="";
        document.getElementById("hintimg").style.display="";
        document.getElementById("label").style.display="none";
        document.getElementById("analysis").style.display="";
    }
    
    // js与ios交互
    function setupWebViewJavascriptBridge(callback) {
        if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
        if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
        window.WVJBCallbacks = [callback];
        var WVJBIframe = document.createElement('iframe');
        WVJBIframe.style.display = 'none';
        WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
        document.documentElement.appendChild(WVJBIframe);
        setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
    }
    
    setupWebViewJavascriptBridge(function(bridge) {
                                 
                                 bridge.registerHandler('javascriptHandler', function(data, responseCallback) {
                                                            loadQuestion(data)
                                                            // 成功后返回
                                                            var responseData = { 'Javascript Says':'Success!' }
                                                            responseCallback(responseData)
                                                        })
                                 
                                 bridge.registerHandler('nextClickHandler', function(data, responseCallback) {
                                                        clickNext(data)
                                                        })
                                 
                                 //上一题目
                                 function clickPrevious(){
                                 
                                 }
                                 
                                 //下一题
                                 function clickNext(data){
                                    //选中的答案
                                    var optionIndex;
                                    $("#ul li").each(function(){
                                        if($(this).attr('class') =='listStyle selectListStyle'){
                                            optionIndex = $(this).attr("id");
                                        }
                                    });
                                    bridge.callHandler('mathObjcCallback', {'optionIndex': optionIndex}, function(response) {
                                                    })
                                 
                                 }
                                 

                                 })
    
    </script>
    
    <div id='question'></div>
    
    <div id='option'></div>
    
    <div class="center">
        <img class="auto_image" id="img"/>
    </div>
    <div>
        <button id="showBtn" class="button" onclick="showAnswer()">显示答案及解析</button>
        <div id='answerCorrect' style="display: none"></div>
        <div id='answer' style="display: none"></div>
        <div id='label' style="display: none">解析:</div>
        <div id='analysis' style="line-height:30px; display: none"></div>
        <div class="center">
            <img id="hintimg" class="auto_image" />
        </div>
    </div>
    
</body>
</html>
