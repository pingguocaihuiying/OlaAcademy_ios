<!--
	作者：forevertxp@gmail.com
	时间：2016-07-14
	描述：布置作业选择题目页面
-->
<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<script type="text/x-mathjax-config">
			MathJax.Hub.Config({ messageStyle: "none", tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]} });
		</script>

		<script type="text/javascript" src="../MathJax.js?config=TeX-AMS_HTML-full"></script>

		<script type="text/javascript" src="../jquery.js"></script>

		<style type='text/css'>
			.optionLine {
				border-bottom: 5px solid #f0f0f0;
				padding: 10px 2px;
				font-size: 16px;
				line-height: 30px;
			}
			
			input[type="checkbox"] {
				-webkit-appearance: none;
				height: 20px;
				vertical-align: middle;
				width: 20px;
				border-width: 0px;
			}
			
			input[type="checkbox"]:checked {
				outline: none;
				background: #fff url(ic_selected.png) no-repeat;
				background-size: contain;
			}
			
			input[type="checkbox"]:not(:checked) {
				outline: none;
				background: #fff url(ic_unselect.png) no-repeat;
				background-size: contain;
			}
			
		</style>

		<script type="text/javascript">
            
            // js与ios交互
            function setupWebViewJavascriptBridge(callback) {
                if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
                if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
                window.WVJBCallbacks = [callback];
                var WVJBIframe = document.createElement('iframe');
                WVJBIframe.style.display = 'none';
                WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
                document.documentElement.appendChild(WVJBIframe);
                setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
            }
        
            setupWebViewJavascriptBridge(function(bridge) {
                                     
                                     bridge.registerHandler('javascriptHandler', function(data, responseCallback) {
                                                            loadQuestion(data)
                                                            // 成功后返回
                                                            var responseData = { 'Javascript Says':'Success!' }
                                                            responseCallback(responseData)
                                                            })
                                         
                                    bridge.registerHandler('nextClickHandler', function(data, responseCallback) {
                                                            clickNext(data)
                                                            })
                                    bridge.registerHandler('chooseAllHandler', function(data, responseCallback) {
                                                           chooseAll(data.choose);
                                                                })
                                         
                                    // 全选
                                    function chooseAll(type){
                                         $("input[type='checkbox']").each(function(){
                                                            if(type==1){
                                                                this.checked = true;
                                                            }else{
                                                                this.checked = false;
                                                            }
                                                        });
                                    }
                                         
                                    //下一步
                                    function clickNext(data){
                                         //选中的题目
                                         var optionIndex="";
                                         $('input:checkbox[name="checkbox"]:checked').each(
                                                    function() {
                                                        optionIndex = optionIndex+$(this).val()+",";
                                                    }
                                                );
                                         bridge.callHandler('mathObjcCallback', {'optionIndex': optionIndex}, function(response) {
                                                            })
                                         
                                    }
                                })
            // 加载数据
			function loadQuestion(data) {
                var obj = eval ("(" + JSON.stringify(data) + ")");
                var html = "<table style='width: 100%; border: 0px'>";
                for(var i=0;i<obj.count;i++){
                    var question = data["question"+i];
                    if(question.title != "") {
                        html +="<tr><td align='left'><div id='option1'>"+ (i+1)+"、"+question.title +"</div></td><td align='right'><input type='checkbox' name='checkbox' value='"+i+"'/></td></tr><tr><td colspan='2'><hr color='#f0f0f0' size='2' width='100%' /></td></tr>";
                    }
                }
                html += "</table>"
                updateMath(html);
            }

			function updateMath(html) {
				var questionDIV = document.getElementById("question");
				questionDIV.innerHTML = html;
				MathJax.Hub.Queue(["Typeset", MathJax.Hub, questionDIV]);
			}
                
			
		</script>
	</head>

	<body>
		<div id='question'></div>
	</body>

</html>
